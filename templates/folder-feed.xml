<?xml version="1.0" encoding="utf-8"?>
{% set ns = namespace(count=0, latest=None) %}
{% set url %}{% include 'links-prefix.txt' %}{{ url_for('view_item', iid=folder) }}{% endset %}
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>{{ folder }} Feed | {% include 'app-title.txt' %}</title>
  <id>{{ url }}</id>
  <link rel="alternate" type="text/html" href="{{ url }}" />
  <link rel="self" type="{{ content_type }}" href="{% include 'links-prefix.txt' %}{{ url_for('view_folder_feed', fid=folder) }}" />
  <generator uri="{{ config.APP_REPO }}">{{ config.APP_NAME }}</generator>
  {%- for item in items -%}
    {%- if ns.count < limit -%}
      {% if item and (not item.status or item.status == "public") %}
        {% include 'feed-entry.xml' %}
        {% set ns.count = ns.count + 1 %}
        {% if not ns.latest %}
          {% set ns.latest = item %}
        {% endif %}
      {% endif %}
    {%- endif -%}
  {%- endfor -%}
  {% if ns.latest and ns.latest.datetime %}
    <updated>{{ ns.latest.datetime.replace(' ', 'T') }}Z</updated>
  {% endif %}
</feed>