{% extends "base.html" %}
{% set feed_url %}{{ url_for('view_user_feed', username=user.username) }}{% endset %}
{% block title %}{{ _('User') }} {{ user.username }}{% endblock %}
{% block canonical %}{{ url_for('view_user', username=user.username) }}{% endblock %}
{% block external %}{{ user.url or "" }}{% endblock %}
{% block metadata %}
  <link rel="alternate" type="{{ ATOM_CONTENT_TYPE }}" href="{{ feed_url }}" title="@{{ user.username }} Feed" />
{% endblock %}
{% block content %}
  <div class="uk-text-center">
    <h2>
      {% if user.url %}<a target="_blank" href="{{ user.url }}">{% endif %}
      {% if name %}<a href="{{ url_for('view_user', username=user.username) }}">{% endif %}
        {{ user.username }}
      {% if name %}</a>{% endif %}
      {% if user.url %}</a>{% endif %}
    </h2>
    {% if user.data.propic %}
      {% with item=load_item(user.data.propic) %}
        <div class="uk-width-medium uk-align-center">
          {% include "item-content.html" %}
        </div>
      {% endwith %}
    {% endif %}
    <p>{{ user.data.description }}</p>
    <div class="uk-margin uk-flex-center uk-grid-small uk-grid" uk-grid>
      <div>
        <a class="uk-button uk-button-default uk-icon-link" href="{{ feed_url }}" target="_blank" rel="nofollow">
          Feed (Atom) <span uk-icon="rss"></span>
        </a>
      </div>
      {% if current_user.is_authenticated and current_user.username == user.username %}
        <div>
          <a class="uk-button uk-button-default uk-icon-link" href="{{ url_for('export_api') }}" target="_blank" rel="nofollow">
            {{ _('Export data') }} (ZIP) <span uk-icon="download"></span>
          </a>
        </div>
        <div>
          <a class="uk-button uk-button-default uk-icon-link" href="{{ url_for('view_settings') }}" rel="nofollow">
            {{ _('Settings') }} <span uk-icon="settings"></span>
          </a>
        </div>
      {% endif %}
    </div>
    {% if not name %}
      <ul class="uk-flex-center uk-tab" uk-tab>
        {% if current_user.is_authenticated and current_user.username == user.username %}
          <li {% if mode == 'comments' %} class="uk-active" {% endif %}><a href="{{ url_for('view_user', username=user.username, mode='comments') }}">{{ _('Comments') }}</a></li>
        {% endif %}
        <li {% if mode == 'created' %} class="uk-active" {% endif %}><a href="{{ url_for('view_user', username=user.username, mode='created') }}">{{ _('Created') }}</a></li>
        <li {% if mode not in ['comments', 'created'] %} class="uk-active" {% endif %}><a href="{{ url_for('view_user', username=user.username, mode='pinned') }}">{{ _('Pinned') }}</a></li>
      </ul>
    {% endif %}
  </div>
  {% if folders | length > 0 %}
    <div uk-grid="masonry: pack" class="uk-grid uk-grid-small uk-child-width-1-2 uk-child-width-1-3@s uk-child-width-1-4@m uk-child-width-1-5@l uk-child-width-1-6@xl">
      {% for folder in folders %}
        <div>
          <a class="uk-link-text" href="{{ url_for('view_user', username=user.username, cid=folder.id) }}">
            <div style="font-size: 0;">
              {% for item in folder['items'] %}
                {% include 'item-content.html' %}
              {% endfor %}
            </div>
            <span class="uk-text-break">{{ folder.id }}</span>
          </a>
        </div>
      {% endfor %}
    </div>
    <hr />
  {% endif %}
  {% if comments %}
    <ul class="uk-list uk-list-divider">
      {% for comment in comments %}
        <li><a href="{{ url_for('view_item', iid=comment.iid) }}#{{ comment.cid }}">{{ comment.datetime }}</a> â€” {{ comment.text }}</li>
      {% endfor %}
    </ul>
  {% else %}
    {% with username=user.username, cid=name %}
      {% include 'collection.html' %}
    {% endwith %}
  {% endif %}
{% endblock %}