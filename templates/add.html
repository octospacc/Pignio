{% extends "base.html" %}
{% block title %}{{ _('Edit' if item else 'Add') }} {{ _('Item') }}{% endblock %}
{% block content %}
  <ul class="uk-tab" uk-tab="connect: .item-type; {% if item.images %} active: 2 {% elif item.text %} active: 1 {% endif %}">
    <li data-name="media"><a {% if item and item.images %} class="uk-disabled" disabled {% endif %} href="#">
      Media <span uk-icon="image"></span>
    </a></li>
    <li data-name="text"><a {% if item and item.images %} class="uk-disabled" disabled {% endif %} href="#">
      {{ _('Text') }} <span uk-icon="quote-right"></span>
    </a></li>
    <li data-name="carousel"><a {% if item and not item.images %} class="uk-disabled" disabled {% endif %} href="#">
      {{ _('Carousel') }} <span uk-icon="thumbnails"></span>
    </a></li>
  </ul>
  <form method="POST" enctype="multipart/form-data" class="add" up-layer="root">
    <input type="hidden" name="id" value="{{ item.id }}" />
    <input type="hidden" name="images" value="{% if item.images %}{{ json.dumps(item.images) }}{% endif %}" />
    <input type="hidden" name="image" />
    <input type="hidden" name="video" />
    <input type="hidden" name="audio" />
    <input type="hidden" name="doc" />
    <div class="uk-card uk-card-default uk-card-small uk-card-body" {% if not item.image %} hidden {% endif %}>
      <p><label><input class="uk-checkbox" type="checkbox" checked> {{ _('Image') }}</label></p>
      <img src="{% if item.image %}{{ url_for('serve_media', filename=item.image) }}{% endif %}" class="image" style="cursor: pointer;" tabindex="0" />
    </div>
    <div class="uk-card uk-card-default uk-card-small uk-card-body" {% if not item.video %} hidden {% endif %}>
      <p><label><input class="uk-checkbox" type="checkbox" checked> {{ _('Video') }}</label></p>
      <video src="{% if item.video %}{{ url_for('serve_media', filename=item.video) }}{% endif %}" class="video" controls></video>
    </div>
    <div class="uk-card uk-card-default uk-card-small uk-card-body" {% if not item.audio %} hidden {% endif %}>
      <p><label><input class="uk-checkbox" type="checkbox" checked> {{ _('Audio') }}</label></p>
      <audio src="{% if item.audio %}{{ url_for('serve_media', filename=item.audio) }}{% endif %}" class="audio" controls></audio>
    </div>
    <div class="uk-card uk-card-default uk-card-small uk-card-body" {% if not item.doc %} hidden {% endif %}>
      <p><label><input class="uk-checkbox" type="checkbox" checked> {{ _('Document') }}</label></p>
      <object data="{% if item.doc %}{{ url_for('serve_media', filename=item.doc) }}{% endif %}" class="doc"></object>
    </div>
    <div class="uk-switcher item-type">
      <div></div>
      <div></div>
      <div class="uk-card uk-card-default uk-card-small uk-card-body">
        <table class="uk-table uk-table-divider images">
          <tbody>
            {% for image in item.images %}
              <tr>
                <td>
                  <button type="button" class="uk-icon-button uk-margin-xsmall-top uk-margin-xsmall-bottom" uk-icon="trash" title="{{ _('Delete') }}" uk-tooltip="{{ _('Delete') }}"></button>
                  <br />
                  <button type="button" class="uk-icon-button uk-margin-xsmall-top uk-margin-xsmall-bottom" uk-icon="chevron-up" title="{{ _('Up') }}" uk-tooltip="{{ _('Up') }}"></button>
                  <br />
                  <button type="button" class="uk-icon-button uk-margin-xsmall-top uk-margin-xsmall-bottom" uk-icon="chevron-down" title="{{ _('Down') }}" uk-tooltip="{{ _('Down') }}"></button>
                </td>
                <td><img src="{{ url_for('serve_media', filename=image) }}" data-file="{{ image }}" style="cursor: pointer;" tabindex="0" /></td>
                {# <td><textarea class="uk-textarea" rows="5" placeholder="Alt Text"></textarea></td> #}
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="uk-grid-small uk-margin-small" uk-grid>
          <div class="uk-width-expand"><div class="uk-inline uk-width-1-1">
            <span class="uk-form-icon" uk-icon="image"></span>
            <input class="uk-input carousel-url" type="text" placeholder="{{ _('Add Image from URL') }}" />
          </div></div>
          <div><button type="button" class="uk-button uk-button-default carousel-add">Add</button></div>
        </div>
        <div class="uk-grid-collapse uk-margin-small" uk-grid>
          <div uk-form-custom class="uk-width-1-1">
            <input class="carousel-upload uk-input" type="file" multiple />
            <button class="uk-button uk-width-1-1 uk-button-default" type="button" tabindex="-1">
              {{ _('upload-tip') }} <span uk-icon="upload"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="uk-margin" uk-grid>
      <div>
        <p><label>
          <input type="checkbox" class="from-link uk-checkbox" {% if not item.id %} checked {% endif %} />
          {{ _('link-fill') }} ğŸ”—
        </label></p>
        <p><label>
          <input name="archive" type="checkbox" class="from-link uk-checkbox" checked {% if item.id %} disabled {% endif %} />
          {{ _('Archive media files') }} ğŸ’¾
        </label></p>
        <p><label>
          <input name="nsfw" type="checkbox" class="uk-checkbox" {% if 'nsfw' in item.systags %} checked {% endif %} />
          {{ _('Mark as sensitive') }} (NSFW) ğŸ”
        </label></p>
        <p><label>
          {{ _('Visibility') }}
          <select class="uk-select" name="status">
            <option value="public" {% if item.status == 'public' %} selected {% endif %}>ğŸŒ {{ _('Public') }}</option>
            <option value="silent" {% if item.status == 'silent' %} selected {% endif %}>ğŸ”‡ {{ _('Silent') }}</option>
            <!-- <option value="unlisted">ğŸ”— {{ _('Unlisted') }}</option> -->
            <!-- <option value="private">ğŸ”’ {{ _('Private') }}</option> -->
          </select>
        </label></p>
        <p><label>
          {{ _('Provenance') }}
          <select class="uk-select" name="provenance">
            <option value="">â“ No provenance</option>
            <option value="oc" {% if 'oc' in item.systags %} selected {% endif %}>ğŸ¨ Original content</option>
            <option value="ai" {% if 'ai' in item.systags %} selected {% endif %}>ğŸ‘¾ AI-generated</option>
          </select>
        </label></p>
      </div>
      {% with langs=item.langs %}
        {% include 'langs-select.html' %}
      {% endwith %}
      {% if not item %}
        <div>
          <label>
            {{ _('Pin to Collections') }}
            <button class="collections-reset uk-button uk-button-default uk-button-small" type="button">Reset</button>
            <select class="uk-select" name="collections" multiple>
              <option value="-" hidden></option>{# Sentinel value to allow sending of empty collections fields when no item is selected #}
              {% for (name, data) in collections.items() %}
                <option value="{{ name }}" {% if not name %} selected {% endif %}>{% if name %}{{ data.title or name }}{% else %}{{ _('Profile') }}{% endif %}</option>
              {% endfor %}
            </select>
          </label>
        </div>
      {% endif %}
      <!-- <label>
        <input type="checkbox" class="with-proxatore uk-checkbox" />
        Transparently use Proxatore
      </label> -->
    </div>
    <div class="uk-margin">
      <div class="uk-grid-collapse" uk-grid>
        <div uk-form-custom class="uk-width-1-1">
          <input class="uk-input" type="file" name="file" />
          <button class="uk-button uk-width-1-1 uk-button-default" type="button" tabindex="-1">
            {{ _('upload-tip') }} <span uk-icon="upload"></span>
          </button>
        </div>
      </div>
    </div>
    <!-- <div class="uk-margin">
      <input type="color" class="uk-input" name="color" value="{{ item.text }}" />
    </div> -->
    <div class="uk-margin">
      <div class="uk-inline uk-width-1-1">
        <button class="uk-form-icon uk-form-icon-flip paste-link" type="button" uk-icon="icon: move"></button>
        <span class="uk-form-icon" uk-icon="icon: link"></span>
        <input class="uk-input" type="text" name="link" placeholder="Link" value="{{ item.link }}" />
      </div>
    </div>
    <div class="uk-margin">
      <div class="uk-inline uk-width-1-1">
        <span class="uk-form-icon" uk-icon="icon: info"></span>
        <input class="uk-input" type="text" name="title" placeholder="{{ _('Title') }}" value="{{ item.title }}" />
      </div>
    </div>
    <div class="uk-margin">
      <textarea class="uk-textarea" rows="5" name="description" placeholder="{{ _('Description') }}">{{ item.description }}</textarea>
    </div>
    <div class="uk-switcher item-type">
      <div class="uk-margin">
        <textarea class="uk-textarea" rows="5" name="alttext" placeholder="Alt Text">{{ item.alttext }}</textarea>
      </div>
      <div class="uk-margin">
        <textarea class="uk-textarea" rows="5" name="text" placeholder="{{ _('Text') }}">{{ item.text }}</textarea>
      </div>
    </div>
    <div class="uk-margin uk-grid-small" uk-grid>
      {% if item %}
        <div class="uk-width-auto back">
          <a class="uk-button uk-button-default" href="{{ url_for('view_item', iid=item.id) }}">{{ _('Back') }}</a>
        </div>
      {% endif %}
      <div class="uk-width-expand">
        <button class="uk-button uk-button-primary uk-width-1-1" type="submit">{{ (_('Edit') + " " + item.id) if item.id else _('Add') }}</button>
      </div>
    </div>
  </form>
{% endblock %}