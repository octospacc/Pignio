{% extends "base.html" %}
{% set full = true %}
{% set image %}{% include 'item-image.html' %}{% endset %}
{% set kindname %}
  {%- if item.doc -%} Document
  {%- elif item.swf -%} Shockwave Flash
  {%- elif item.rom -%} ROM
  {%- elif item.font -%} Font
  {%- elif item.model -%} 3D Model
  {%- elif item.audio -%} Audio
  {%- elif item.video -%} Video
  {%- elif item.image and not item.text -%} Image
  {%- endif -%}
{% endset %}
{% block title %}{% include "item-title.txt" %}{% endblock %}
{% block canonical %}{{ url_for('view_item', iid=item.id) }}{% endblock %}
{% block metadata %}
  <meta name="twitter:title" property="og:title" content="{{ title }}" />
  {% if item.description %}
    <meta name="twitter:description" property="og:description" content="{{ item.description }}" />
    <meta name="description" content="{{ item.description }}" />
  {% endif %}
  {% if image %}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" property="og:image" content="{{ image }}" />
  {% endif %}
  {% if item.video %}
    <meta property="og:video" content="{{ url_for('serve_media', filename=item.video) }}" />
    <meta property="og:video:type" content="video/{{ item.video.split('.')[-1] }}" />
  {% endif %}
  {% if item.audio %}
    <meta property="og:audio" content="{{ url_for('serve_media', filename=item.audio) }}" />
  {% endif %}
{% endblock %}
{% block content %}
  {% with path=item.id, always=false %}
    {% include "breadcrumbs.html" %}
  {% endwith %}
  <article class="uk-flex uk-flex-wrap item" data-item-id="{{ item.id }}">
    <div class="uk-width-1-1 uk-width-1-2@s uk-padding-small">
      {% include "item-content.html" %}
    </div>
    <div class="uk-width-1-1 uk-width-1-2@s uk-padding-small">
      <div>
        {% if kindname %}
          <span class="uk-text-meta">{{ _(kindname) }}</span>
        {% endif %}
        <h3 class="uk-text-break uk-margin-small-top">{% include "item-title.txt" %}</h3>
        {% if item.creator %}
          by <a href="{{ url_for('view_user', username=item.creator) }}" {% if embed %} target="_blank" {% endif %}>{{ item.creator }}</a>
        {% endif %}
        {% if item.datetime %}
          at <span>{{ item.datetime }}</span>
        {% endif %}
        {% if item.link %}
        <div class="uk-text-truncate">
          <a href="{{ item.link }}" target="_blank">{{ item.link }}</a>
        </div>
        {% endif %}
        <div class="uk-margin">
          {% for tag in item.systags %}
            <button class="uk-button uk-button-default uk-button-small" uk-toggle="target: #modal-systags-{{ tag }}">{{ tag }}</button>
            <div id="modal-systags-{{ tag }}" uk-modal>
              <div class="uk-modal-dialog uk-modal-body {{ colortheme }}">
                <button class="uk-modal-close-default" type="button" uk-close></button>
                <h2 class="uk-modal-title">{{ _('Marking') }}: "{{ tag }}"</h2>
                <p>{{ _('systag-' + tag) }}</p>
              </div>
            </div>
          {% endfor %}
          {% for lang in item.langs %}
            <button class="uk-button uk-button-default uk-button-small uk-disabled" disabled>{{ lang }}</button>
          {% endfor %}
        </div>
        <div class="uk-margin uk-grid-small uk-grid" uk-grid>
          <div class="uk-visible@s">
            <button class="uk-icon-button expand-shrink" uk-icon="expand" title="{{ _('Expand') }}" uk-tooltip="{{ _('Expand') }}" onclick="Pignio.expandShrinkContent();"></button>
          </div>
          {% if item.image or item.video %}
            <div>
              <button class="uk-icon-button" uk-icon="bolt" title="{{ _('switch-render-mode') }}" uk-tooltip="{{ _('switch-render-mode') }}" onclick="Pignio.switchRenderMode();"></button>
            </div>
          {% endif %}
          <div>
            <button class="uk-icon-button" uk-icon="forward" title="{{ _('Copy to clipboard') }}" uk-tooltip="{{ _('Copy to clipboard') }}" onclick="Pignio.copyToClipboard();"></button>
          </div>
          <div class="pin">
            {% if embed %}
              <a class="uk-button uk-button-primary" href="{{ url_for('view_item', iid=item.id) }}" target="_blank">
                View on {{ config.APP_NAME }} <span uk-icon="tag"></span>
              </a>
            {% elif not config.FREEZING %}
              <button class="uk-button uk-button-primary uk-disabled" disabled>
                Pin <span uk-icon="tag"></span>
              </button>
              <div class="{{ colortheme }}" uk-dropdown="mode: click; stretch: y;">
                <ul class="uk-list">
                  <li><button class="uk-button uk-button-default uk-button-small" uk-toggle="target: #new-collection">{{ _('New Collection') }}</button></li>
                </ul>
              </div>
            {% endif %}
          </div>
          {% if not (embed or config.FREEZING) and (not current_user.is_authenticated or get_item_permissions(item).edit) %}
            {% if (item.video or (item.audio and not item.audio.lower().endswith((".mid", ".midi")))) and config.FFMPEG_AVAILABLE %}
              <div class="uk-button-group">
                <a class="uk-button uk-button-default uk-icon-link" href="{{ url_for('add_item') }}?item={{ item.id }}" rel="nofollow">
                  {{ _('Edit') }} <span uk-icon="file-edit"></span>
                </a>
                <div class="uk-inline">
                  <button class="uk-button uk-button-default" type="button" aria-label="Toggle Dropdown"><span uk-icon="icon:  triangle-down"></span></button>
                  <div uk-dropdown="mode: click; target: !.uk-button-group;">
                    <ul class="uk-nav uk-dropdown-nav">
                      <li><a href="{{ url_for('add_item') }}?item={{ item.id }}" rel="nofollow" up-layer="new">
                        {{ _('Edit') }} <span uk-icon="file-edit"></span>
                      </a></li>
                      <li class="uk-nav-divider"></li>
                      {% if item.video %}
                        <li><a href="{{ url_for('video_join') }}?iid={{ item.id }}" rel="nofollow" up-layer="new">
                          {{ _('Join') }} <span uk-icon="link"></span>
                        </a></li>
                      {% endif %}
                      <li><a href="{{ url_for('media_trim') }}?iid={{ item.id }}" rel="nofollow" up-layer="new">
                        {{ _('Trim') }} <span uk-icon="crosshairs"></span>
                      </a></li>
                      {# <li><a href="#">{{ _('Crop') }} <span uk-icon="shrink"></span></a></a></li> #}
                      {# <li><a href="#">{{ _('Compress') }} <span uk-icon="pull"></span></a></a></li> #}
                    </ul>
                  </div>
                </div>
              </div>
            {% else %}
              <div>
                <a class="uk-button uk-button-default uk-icon-link" href="{{ url_for('add_item') }}?item={{ item.id }}" rel="nofollow">
                  {{ _('Edit') }} <span uk-icon="file-edit"></span>
                </a>
              </div>
            {% endif %}
            <div>
              <a class="uk-button uk-button-default" href="{{ url_for('remove_item') }}?item={{ item.id }}" rel="nofollow" up-layer="new">
                {{ _('Delete') }} <span uk-icon="trash"></span>
              </a>
            </div>
          {% endif %}
          {% if not (embed or config.FREEZING) and (not current_user.is_authenticated or not get_item_permissions(item).edit) %}
            <div>
              <a class="uk-button uk-button-default" href="{{ url_for('report_item') }}?item={{ item.id }}" rel="nofollow" up-layer="new">
                {{ _('Report') }} <span uk-icon="warning"></span>
              </a>
            </div>
          {% endif %}
        </div>
        {% include 'item-description.html' %}
      </div>
      <div class="uk-padding uk-padding-remove-left uk-padding-remove-right">
        {% if not (embed or config.FREEZING) %}
          <form method="POST">
            <div class="uk-margin">
              <div class="uk-inline uk-width-1-1">
                <input class="uk-input" type="text" name="comment" placeholder="{% if current_user.is_authenticated %} {{ _('comment-placeholder') }} " {% else %} Please login to comment. " disabled {% endif %} required />
              </div>
              <div class="uk-inline uk-width-1-1">
                <input class="uk-input uk-button uk-button-default {% if not current_user.is_authenticated %} uk-disabled" disabled {% else %} " {% endif %} type="submit" value="{{ _('do-comment') }}" />
                <span class="uk-form-icon uk-form-icon-flip" uk-icon="comment"></span>
              </div>
            </div>
          </form>
        {% endif %}
        {% for item in comments %}
          {% set iid %}{{ item.id.split('/')[-1] }}{% endset %}
          <div class="uk-card uk-margin uk-card-default uk-card-small {{ colortheme }}" id="{{ iid }}">
            <div class="uk-card-header">
              <h3 class="uk-card-title">
                {% if item.creator %}
                  <a class="uk-link-text" href="{{ url_for('view_user', username=item.creator) }}">{{ item.creator }}</a>
                {% else %}
                  <i>Anon</i>
                {% endif %}
                <a href="#{{ iid }}" class="uk-text-small uk-link-reset">
                  {% if item.datetime %}
                    # {{ item.datetime }}
                  {% else %}
                    #{{ iid }}
                  {% endif %}
                </a>
                {% if not (embed or config.FREEZING) %}
                  <div class="uk-float-right uk-grid-small" uk-grid>
                    {% if get_item_permissions(item).edit %}
                      <div>
                        <a href="{{ url_for('remove_item', item=item.id) }}" rel="nofollow" up-layer="new" class="uk-icon-button uk-float-right" uk-icon="trash" title="{{ _('Delete') }}"></a>
                      </div>
                    {% else %}
                      <div>
                        <a href="{{ url_for('report_item', item=item.id) }}" rel="nofollow" up-layer="new" class="uk-icon-button uk-float-right" uk-icon="warning" title="{{ _('Report') }}"></a>
                      </div>
                    {% endif %}
                  </div>
                {% endif %}
              </h3>
            </div>
            <div class="uk-card-body">{{ item.text }}</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </article>
  {% if not (embed or config.FREEZING) %}
    <div id="new-collection" uk-modal>
      <div class="uk-modal-dialog uk-modal-body {{ colortheme }}">
        <button class="uk-modal-close-default" uk-close></button>
        <h2 class="uk-modal-title">{{ _('New Collection') }}</h2>
        <div class="uk-margin">
          <input class="uk-input" type="text" placeholder="{{ _('Name') }}" />
          <span class="uk-text-meta"><span class="notice"></span>&nbsp;</span>
        </div>
        <div class="uk-margin">
          <button class="uk-button uk-button-primary">{{ _('Create') }}</button>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}